{% extends 'inventory/base.html' %}
{% load static %}
{% load custom_tags %}

{% block body %}
  <div class="container mt-4">
    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">{{ message }}</div>
      {% endfor %}
    {% endif %}
    <form method="get" class="mb-3">
        <label for="entry_method" class="form-label">Filter by entry method:</label>
        <select name="entry_method" onchange="this.form.submit()" class="form-select w-auto d-inline">
            <option value="all" {% if not entry_method or entry_method == 'all' %}selected{% endif %}>All</option>
            
            <option value="batch_entry" {% if entry_method == "batch_entry"  %}selected{% endif %}>Batch entry method</option>
            <option value="normal_entry" {% if entry_method == "normal_entry" %}selected{% endif %}>Normal method</option>
    
        </select> 

    </form>
    <a class="" href="{% url 'add_warehouseitem' %}">Add warehouse item</a>

    <a class="" href="{% url 'batch_entry' %}">Bulk Add (Excel file)</a>

    <div class="accordion" id="warehouseAccordion">
      <!-- 1. Warehouse Items -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingWarehouse"><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseWarehouse" aria-expanded="true" aria-controls="collapseWarehouse">üì¶ Warehouse Items

          <span style="
        display: inline-block;
        padding: 1px 1px;
        font-size:13px;
        margin-left: 3px;
        font-weight: normal;
        color: #ffffffff;
        background-color: rgba(49, 122, 0, 1);
        border: 1px solid #ddd;
        border-radius: 5px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      "> Following items are available<span >
        </button></h2>
        <div id="collapseWarehouse" class="accordion-collapse collapse show" aria-labelledby="headingWarehouse" data-bs-parent="#warehouseAccordion">
          <div class="accordion-body">
            {% if warehouse_items %}
              <table class="table table-striped table-sm align-middle">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Part Number</th>
                    <th>Price</th>
                    <th>Quantity</th>
                  </tr>
                </thead>
                <tbody>
                  {% for item in warehouse_items %}
                    <tr>
                      <td>
                        <a href="{% url 'update_warehouse_item' item.id %}">{{ item.name }}</a>
                      </td>
                      <td>{{ item.part_number }}</td>
                      <td>${{ item.price }}</td>
                      <td>{{ item.warehouse_quantity }}</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            {% else %}
              <p class="text-muted">No items in the warehouse.</p>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- 2. Taken Warehouse Items -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingUsed"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseUsed" aria-expanded="false" aria-controls="collapseUsed">üöö Used Warehouse Items  
<span style="
        display: inline-block;
        padding: 1px 1px;
        font-size:13px;
        margin-left: 3px;
        font-weight: normal;
        color: #ffffffff;
        background-color: rgba(206, 0, 0, 1);
        border: 1px solid #ddd;
        border-radius: 5px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      "> Following items are used<span >

        </button></h2>
        <div id="collapseUsed" class="accordion-collapse collapse" aria-labelledby="headingUsed" data-bs-parent="#warehouseAccordion">
          <div class="accordion-body">
            {% if used_warehouse_items %}
              <table class="table table-striped table-sm align-middle">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Part Number</th>
                    <th>Price</th>
                    <th>Arrived Qty</th>
                    <th>Moved</th>
                    <th>Job</th>
                  </tr>
                </thead>
                <tbody>
                  {% for item in used_warehouse_items %}
                    <tr>
                      <td>
                        <a href="{% url 'update_warehouse_item' item.id %}">{{ item.item.name }}</a>
                      </td>
                      <td>{{ item.part_number }}</td>
                      <td>${{ item.price }}</td>
                      <td>{{ item.arrived_quantity }}</td>
                      <td>{{ item.warehouse_quantity }}</td>
                      <td>
                        <a href="{% url 'update_job' item.job.job_id %}">{{ item.job }}</a>
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            {% else %}
              <p class="text-muted">No taken items.</p>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- 3. Moved Items -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingMoved"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseMoved" aria-expanded="false" aria-controls="collapseMoved">üîÑ Items Moved to Warehouse After Job        <span style="
        display: inline-block;
        padding: 1px 1px;
        font-size:13px;
        margin-left: 3px;
        font-weight: normal;
        color: #ffffffff;
        background-color: rgba(49, 122, 0, 1);
        border: 1px solid #ddd;
        border-radius: 5px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      "> Following items are available<span ></button></h2>
        <div id="collapseMoved" class="accordion-collapse collapse" aria-labelledby="headingMoved" data-bs-parent="#warehouseAccordion">
          <div class="accordion-body">
            {% if moved_items %}
              <table class="table table-striped table-sm align-middle">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Part Number</th>
                    <th>Price</th>
                    <th>Quantity Moved</th>
                  </tr>
                </thead>
                <tbody>
                  {% for item in moved_items %}
                    <tr>
                      <td>
                        <a href="{% url 'update_warehouse_item' item.id %}">{{ item.name }}</a>
                      </td>
                      <td>{{ item.part_number }}</td>
                      <td>${{ item.price }}</td>
                      <td>{{ item.warehouse_quantity }}</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            {% else %}
              <p class="text-muted">No items have been moved for jobs.</p>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- 4. Taken Moved Items -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingUsedMoved"><button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseUsedMoved" aria-expanded="false" aria-controls="collapseUsedMoved">üîÅ Used Moved Items

          <span style="
        display: inline-block;
        padding: 1px 1px;
        font-size:13px;
        margin-left: 3px;
        font-weight: normal;
        color: #ffffffff;
        background-color: rgba(206, 0, 0, 1);
        border: 1px solid #ddd;
        border-radius: 5px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      "> Following items are used<span >
        </button></h2>
        <div id="collapseUsedMoved" class="accordion-collapse collapse" aria-labelledby="headingUsedMoved" data-bs-parent="#warehouseAccordion">
          <div class="accordion-body">
            <table class="table table-striped table-sm align-middle">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Part Number</th>
                  <th>Price</th>
                  <th>Quantity Moved</th>
                  <th>Taken For Job</th>
                  <th>Originally For</th>
                </tr>
              </thead>
              <tbody>
                {% for item in used_moved_items %}
                  <tr>
                    <td>
                      <a href="{% url 'update_warehouse_item' item.id %}">{{ item.name }}</a>
                    </td>
                    <td>{{ item.part_number }}</td>
                    <td>${{ item.price }}</td>
                    <td>{{ item.quantity_moved }}</td>
                    <td>
                      <a href="{% url 'update_job' item.job.job_id %}">{{ item.job }}</a>
                    </td>
                    <td>
                      <a href="{% url 'update_job' item.was_for_job.job_id %}">{{ item.was_for_job.address }}</a>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div> <!-- /accordion -->
  </div> <!-- /container -->
{% endblock %}
