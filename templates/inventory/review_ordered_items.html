{% extends 'inventory/base.html' %}
{% load static %}
{% load custom_tags %}

{% block body %}
  <div class="container mt-4">
    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">{{ message }}</div>
      {% endfor %}
    {% endif %}
    <form method="get" class="mb-3">
        <label for="entry_method" class="form-label">Filter by entry method:</label>
        <select name="entry_method" onchange="this.form.submit()" class="form-select w-auto d-inline">
            <option value="all" {% if not entry_method or entry_method == 'all' %}selected{% endif %}>All</option>
            
            <option value="batch_entry" {% if entry_method == "batch_entry"  %}selected{% endif %}>Batch entry method</option>
            <option value="normal_entry" {% if entry_method == "normal_entry" %}selected{% endif %}>Normal method</option>
    
        </select> 
        <label for="items_status" class="form-label">Filter by entry method:</label>
        <select name="items_status" onchange="this.form.submit()" class="form-select w-auto d-inline">
            <option value="available" {% if not items_status or items_status == 'available' %}selected{% endif %}>Available parts</option>
            
            <option value="used" {% if items_status == "used"  %}selected{% endif %}>Used parts from warehouse</option>
            <option value="linked" {% if items_status == "linked" %}selected{% endif %}>Linked to a job</option>
    
        </select>
<div class="col-auto  ">
    <label for="search" class="form-label mb-0 me-1">Search</label>
    <input type="search" name="q"
      class="form-control form-control-sm w-auto"
      placeholder="Search jobs"
      aria-label="Search"
      value="{{ request.GET.q }}" />
  </div>
    </form>


   <a href="{% url 'add_warehouseitem' %}" 
   style="
      display: inline-block;
      margin: 4px;
      padding: 8px 16px;
      background: linear-gradient(135deg, #4facfe, #00f2fe);
      color: white;
      font-weight: 600;
      font-size: 0.9rem;
      border-radius: 8px;
      text-decoration: none;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      transition: all 0.2s ease;
   "
   onmouseover="this.style.background='linear-gradient(135deg, #00f2fe, #4facfe)'; this.style.transform='scale(1.05)';"
   onmouseout="this.style.background='linear-gradient(135deg, #4facfe, #00f2fe)'; this.style.transform='scale(1)';">
   âž• Add Warehouse Item
</a>

<a href="{% url 'batch_entry' %}" 
   style="
      display: inline-block;
      margin: 4px;
      padding: 8px 16px;
      background: linear-gradient(135deg, #43e97b, #38f9d7);
      color: white;
      font-weight: 600;
      font-size: 0.9rem;
      border-radius: 8px;
      text-decoration: none;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      transition: all 0.2s ease;
   "
   onmouseover="this.style.background='linear-gradient(135deg, #38f9d7, #43e97b)'; this.style.transform='scale(1.05)'; "
   onmouseout="this.style.background='linear-gradient(135deg, #43e97b, #38f9d7)'; this.style.transform='scale(1)';">
   ðŸ“‚ Bulk Add (Excel File)
</a>

    <div class="accordion">
      <!-- 1. Warehouse Items -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingWarehouse">ðŸ§¾Review Ordered Items
          <span style="
        display: inline-block;
        padding: 1px 1px;
        font-size:13px;
        margin-left: 3px;
        font-weight: normal;
        color: #ffffffff;
        background-color: rgba(49, 122, 0, 1);
        border: 1px solid #ddd;
        border-radius: 5px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      "> Following items are Ordered for certain jobs and they haven't been used yet.<span >
        </h2>
        <div >
          <div class="accordion-body">
            {% if items %}
              <table class="table table-striped table-sm align-middle">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Part Number</th>
                    <th>Price</th>
                    <th>Ordered Qty</th>
                    <th>Arrived Qty</th>
                    <th>Job</th>
                  </tr>
                </thead>
                <tbody>
                  {% for item in items %}
                    <tr >
                      <td>
                        <a href="{% url 'update_item' item.id %}">{{ item.name }}</a>
                      </td>
                      <td>{{ item.part_number }}</td>
                      <td>${{ item.price }}</td>
                      <td >{{ item.job_quantity }}</td>

                      <td {% if item.job_quantity == item.arrived_quantity %} style="background-color: #43e97b;" {% else %}style="background-color: #b51e0eff;"{% endif %}>
                        <form action="" method="post">
                          {% csrf_token %}
                          <input type="hidden" name="item_id" value="{{item.id}}">
                        <select name="arrived"  onchange="this.form.submit()"  id="">
                            <option value="0" {% if item.arrived_quantity == 0 %}selected{% endif %}>0</option>

{% for i in item.job_quantity|num_range %}

                            <option value="{{i}}" {% if item.arrived_quantity == i %}selected{% endif %}>{{i}}</option>
                          {% endfor %}

                        </select>
                        </form>
                      
                      
                      </td>
                      <td><a href="{% url "update_job" item.job.job_id %}">{{item.job.address}}</a></td>
                      
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            {% else %}
              <p class="text-muted">No items.</p>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- 2. Taken Warehouse Items -->
      
      <!-- 3. Moved Items -->
           <!-- 4. Taken Moved Items -->
    </div> <!-- /accordion -->
  </div> <!-- /container -->
{% endblock %}
