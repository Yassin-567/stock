{% extends 'inventory/base.html' %}
{% load static %}
{% load custom_tags %}

{% block body %}
  <div class="container mt-4">
    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">{{ message }}</div>
      {% endfor %}
    {% endif %}<div class="d-flex justify-content-between align-items-start mb-3 flex-wrap">

    <form method="get" class="row row-cols-lg-auto g-2 align-items-center mb-0"
        style="
          width: fit-content;
          padding: 8px 14px;
          background-color: #2e3946;
          color: #a5e1c7;
          border-radius: 10px;
          display: flex;
          align-items: center;
          gap: 10px;
          flex-wrap: wrap;
        ">

        <div class="col-auto">
            <label for="items_status" class="form-label mb-0 me-1 ">Filter status:</label>
            <select name="items_status" onchange="this.form.submit()" class="form-select form-select-sm w-auto">
                <option value="all" {% if not items_status or items_status == 'all' %}selected{% endif %}>All</option>
                <option value="arrived" {% if items_status == 'arrived' %}selected{% endif %}>Arrived</option>
                <option value="not_arrived" {% if items_status == "not_arrived" %}selected{% endif %}>Awaiting</option>
            </select>
        </div>

        <div class="col-auto">
            <label for="ordered_from_date" class="form-label mb-0  ">From</label>
            <input type="text" id="date" name="ordered_from_date"
                class="form-control form-control-sm w-auto flatpickr_date"
                placeholder="Select date"
                value="{{ request.GET.ordered_from_date }}" />
        </div>

        <div class="col-auto">
            <label for="ordered_to_date" class="form-label mb-0 me-1 ">To</label>
            <input type="text" id="date" name="ordered_to_date"
                class="form-control form-control-sm w-auto flatpickr_date"
                placeholder="Select date"
                value="{{ request.GET.ordered_to_date }}" />
        </div>

        <div class="col-auto">
            <label for="search" class="form-label mb-0 me-1">Search</label>
            <input type="search" name="q"
                class="form-control form-control-sm w-auto"
                placeholder="Search"
                aria-label="Search"
                value="{{ request.GET.q }}" />
        </div>

        <div class="col-auto">
            <button type="submit" class="btn btn-sm mt-2" style="background-color: #009e6c;">
                <i class="bi bi-funnel"></i> Apply
            </button>
        </div>
 <div class="col-auto">
              <a style="font-size: larger;color: #b51e0eff;" href="{% url "review_ordered_items" %}">X</a>
            
        </div>
    </form>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
flatpickr('.flatpickr_date', {
enableTime: false,
dateFormat: 'Y-m-d',
altInput: true,
altFormat: 'F j, Y'
})
</script>

 <div style="display: flex; align-items: center; justify-content: space-between; width: 100%;">


    <a href="{% url 'warehouse' %}" 
    style="
        display: inline-block;
        margin: 4px;
        padding: 8px 16px;
        background: linear-gradient(135deg, #1e2e3cff, #151a1aff);
        color: white;
        font-weight: 600;
        font-size: 0.9rem;
        border-radius: 8px;
        text-decoration: none;
        box-shadow: 0 2px 6px rgba(0,0,0,0.15);
        transition: all 0.2s ease;
    "
    onmouseover="this.style.background='linear-gradient(135deg, #424949ff, #4d4f52ff)'; this.style.transform='scale(1.05)';"
    onmouseout="this.style.background='linear-gradient(135deg, #1e2e3cff, #151a1aff)'; this.style.transform='scale(1)';">
        ðŸ”™Back to Warehouse
    </a>

</div>

    <div class="accordion">
      <!-- 1. Warehouse Items -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingWarehouse">ðŸ§¾Review Ordered Items
          <span style="
        display: inline-block;
        padding: 1px 1px;
        font-size:13px;
        margin-left: 3px;
        font-weight: normal;
        color: #ffffffff;
        background-color: rgba(49, 122, 0, 1);
        border: 1px solid #ddd;
        border-radius: 5px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      "> Following items are Ordered for certain jobs and they haven't been used yet.<span >
        </h2>
        <div >



          <div class="accordion-body">
            {% if items %}
              <table class="table table-striped table-sm align-middle">
                <thead>
                  <tr>


<th>
{% sortable 'name' 'Name' sort clean_query %}

</th>


                    <th>
                      {% sortable 'part_number' 'Part Number' sort clean_query %}
                    </th>
                    <th>{% sortable 'price' 'Price' sort clean_query %}
                      

                    </th>
                    <th>{% sortable 'ordered_date' 'Order date' sort clean_query %}
                    </th>

                    <th>{% sortable 'job_quantity' 'Ordered Quantity' sort clean_query %}


                    </th>
                    <th>{% sortable 'arrived_quantity' "Arrived Quantity" sort clean_query %}
                
                    </th>
                    <th>Job
                      
                    </th>
                
                  </tr>
                </thead>
                <tbody>
                  {% for item in items %}
                    <tr >
                      <td>
                        <a href="{% url 'update_item' item.id %}">{{ item.name }}</a>
                      </td>
                      <td>{{ item.part_number }}</td>
                      <td>{{request.user.company.settings.currency_symbol}}{{ item.price }}</td>
                      <td>{{ item.ordered_date }}</td>

                      <td >{{ item.job_quantity }}</td>

                      <td {% if item.arrived%} style="background-color: #43e97b;" {% else %}style="background-color: #b51e0eff;"{% endif %}>
                        <form action="" method="post">
                          {% csrf_token %}
                          <input type="hidden" name="item_id" value="{{item.id}}">
                        <select name="arrived"  onchange="this.form.submit()"  id="">
                            <option value="0" {% if item.arrived_quantity == 0 %}selected{% endif %}>0</option>

{% for i in item.job_quantity|num_range %}

                            <option value="{{i}}" {% if item.arrived_quantity == i %}selected{% endif %}>{{i}}</option>
                          {% endfor %}

                        </select>
                        </form>
                      
                      
                      </td>
                      <td><a href="{% url "update_job" item.job.job_id %}">{{item.job.address}}</a></td>
                      
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            {% else %}
              <p class="text-muted">No items.</p>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- 2. Taken Warehouse Items -->
      
      <!-- 3. Moved Items -->
           <!-- 4. Taken Moved Items -->
    </div> <!-- /accordion -->
  </div> <!-- /container -->

  

<div class="d-flex justify-content-center mt-4">
<nav>
<ul class="pagination pagination-sm mb-0">
{% if page_obj.has_previous %}
  <li class="page-item">
    <a class="page-link"
      href="?page=1{{querystring}}"
      title="First">&laquo;</a>
  </li>
  <li class="page-item">
    <a class="page-link"
      href="?page={{ page_obj.previous_page_number }}{{querystring}}"
      title="Previous">&lsaquo;</a>
  </li>
  {% else %}
  <li class="page-item disabled"><span class="page-link">&laquo;</span></li>
  <li class="page-item disabled"><span class="page-link">&lsaquo;</span></li>
{% endif %}

<li class="page-item active"><span class="page-link">{{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span></li>

{% if page_obj.has_next %}
  <li class="page-item">
    <a class="page-link"
      href="?page={{ page_obj.next_page_number }}{{querystring}}"
      title="Next">&rsaquo;</a>
  </li>
  <li class="page-item">
    <a class="page-link"
      href="?page={{ page_obj.paginator.num_pages }}{{querystring}}"
      title="Last">&raquo;</a>
  </li>
{% else %}
  <li class="page-item disabled"><span class="page-link">&rsaquo;</span></li>
  <li class="page-item disabled"><span class="page-link">&raquo;</span></li>
{% endif %}
</ul>
</nav>
</div>
{% endblock %}
